{% extends 'base.html' %}

{% block title %}History - Budget Tracker{% endblock %}

{% block content %}
<div class="container">
    <div class="month-nav">
        <a href="{% url 'history' %}?year={{ prev_month.year }}&month={{ prev_month.month }}">‚Üê Prev</a>
        <div class="current-month">{{ current_month|date:"F Y" }}</div>
        <a href="{% url 'history' %}?year={{ next_month.year }}&month={{ next_month.month }}">Next ‚Üí</a>
    </div>

    {% if month_total > 0 %}
    <div class="total-display">
        <div class="total-label">Monthly Total</div>
        <div class="total-amount">${{ month_total|floatformat:2 }}</div>
    </div>

    <div class="card">
        <h3 style="margin-bottom: 15px; font-size: 18px;">Spending by Category</h3>
        {% for cat in category_summary %}
        <div class="expense-item">
            <div class="expense-info">
                <div class="expense-category">{{ cat.category_display }}</div>
                <div class="expense-description">{{ cat.count }} transaction{{ cat.count|pluralize }}</div>
            </div>
            <div class="expense-amount">${{ cat.total|floatformat:2 }}</div>
        </div>
        {% endfor %}
    </div>

    <div class="card">
        <h3 style="margin-bottom: 15px; font-size: 18px;">Daily Breakdown</h3>
        {% for day in daily_expenses %}
        <div class="expense-item">
            <div class="expense-info">
                <a href="{% url 'daily_detail' day.date|date:'Y-m-d' %}" style="text-decoration: none; color: #333;">
                    <div class="expense-category">{{ day.date|date:"l, M d" }}</div>
                </a>
            </div>
            <div class="expense-amount">${{ day.total|floatformat:2 }}</div>
        </div>
        {% endfor %}
    </div>

    <div class="card">
        <h3 style="margin-bottom: 15px; font-size: 18px;">All Transactions</h3>
        {% for expense in expenses %}
        <div class="expense-item">
            <div class="expense-info">
                <div class="expense-category">
                    {{ expense.get_category_display }}
                    <span style="color: #999; font-size: 12px;">‚Ä¢ {{ expense.date|date:"M d" }}</span>
                </div>
                {% if expense.description %}
                <div class="expense-description">{{ expense.description }}</div>
                {% endif %}
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <div class="expense-amount">${{ expense.amount|floatformat:2 }}</div>
                <a href="{% url 'expense_edit' expense.pk %}" style="color: #667eea; text-decoration: none; font-size: 14px;">‚úèÔ∏è</a>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
    <div class="card">
        <div class="empty-state">
            <div class="empty-state-icon">üì≠</div>
            <p>No expenses recorded this month</p>
            <a href="{% url 'home' %}" class="btn btn-primary" style="margin-top: 20px; max-width: 200px; margin-left: auto; margin-right: auto;">Add First Expense</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}